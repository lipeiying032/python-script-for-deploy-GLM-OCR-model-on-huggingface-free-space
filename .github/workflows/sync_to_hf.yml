name: ðŸ”„ Sync to HuggingFace Space

on:
  push:
    branches:
      - main
    paths:
      - "hf_space/**"

jobs:
  sync-to-hf:
    name: Sync hf_space/ â†’ HuggingFace Space
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          lfs: true

      - name: Install huggingface_hub
        run: pip install huggingface_hub

      - name: Push hf_space/ to HuggingFace Space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          HF_SPACE_ID: ${{ secrets.HF_SPACE_ID }}
        run: |
          python - <<'EOF'
          import os
          from huggingface_hub import HfApi

          token = os.environ["HF_TOKEN"]
          repo_id = os.environ["HF_SPACE_ID"]   # e.g. "your_name/glm-ocr-api"

          api = HfApi(token=token)
          print(f"[SYNC] Uploading hf_space/ â†’ {repo_id} ...")

          api.upload_folder(
              folder_path="hf_space",
              repo_id=repo_id,
              repo_type="space",
              commit_message="Auto-sync from GitHub",
          )
          print("[SYNC] âœ“ Done!")
          EOF
